# Week of 2024-09-09 to 2024-09-16 (38)

### GHFirst (5)

- [Revert "[Inductor] Rename `cpp_wrapper_cuda.py` as `cpp_wrapper_gpu.py` (#135313)"](https://github.com/pytorch/pytorch/commit/deee21cb78972e36eaf6eba7b84ecedf7da1051b)
  - breaks internal builds ([comment](https://github.com/pytorch/pytorch/pull/135313#issuecomment-2349662091))
- [Revert "[aoti] Fix workspace generation for triton (#135552)"](https://github.com/pytorch/pytorch/commit/18f9331e5deb4c02ae5c206e133a9b4add49bd97)
  - blocks revert of #135313, internal failures, see D62511427 ([comment](https://github.com/pytorch/pytorch/pull/135552#issuecomment-2349641372))
- [Revert "Fix clang-tidy warnings in Caffe2 code (#134935)"](https://github.com/pytorch/pytorch/commit/564d00f36423196152a98006b118690b58324c4d)
  - breaks internal builds, caffe2 is still used internally ([comment](https://github.com/pytorch/pytorch/pull/134935#issuecomment-2349368152))
- [Revert "[Partitioner] Reuse partition to check whether nodes exist (#135317)"](https://github.com/pytorch/pytorch/commit/c025f7becc819fdba4727350746a69ceff4a5bb6)
  - BC-breaking, breaks executorch and internal meta builds ([comment](https://github.com/pytorch/pytorch/pull/135317#issuecomment-2344730294))
- [Revert "[AOTI] Fix assert_function call in cpu autotune template (#135086)"](https://github.com/pytorch/pytorch/commit/0a9d55d2ee87ad5fe656ba6dc2e9cbf64c5d153f)
  - breaks internal tests, see D62405818 ([comment](https://github.com/pytorch/pytorch/pull/135086#issuecomment-2341889428))

### Ignored Signal (8)

- [Revert "[Dynamo] Use custom backend to reenter metadata tf mode when tracing while/cond (#134732)"](https://github.com/pytorch/pytorch/commit/7ed0563cad243e1a9955d8414a271c34e307372d)
  - Broke tests on main ([comment](https://github.com/pytorch/pytorch/pull/134732#issuecomment-2348886378))
- [Revert "[Dynamo] Trace torch function modes entered outside of torch.compile (#133137)"](https://github.com/pytorch/pytorch/commit/eb7dd91dd10e2865029a21ec790df09137d580ae)
  - Broke tests on main ([comment](https://github.com/pytorch/pytorch/pull/134732#issuecomment-2348886378))
- [Revert "[Dynamo] Support thread local setattr (#135443)"](https://github.com/pytorch/pytorch/commit/3f30360d05b4e7ed61ecccdb4729a17b025f2b4f)
  - Broke tests on main ([comment](https://github.com/pytorch/pytorch/pull/134732#issuecomment-2348886378))
- [Revert "[Dynamo] Simplify torch function mode stack guard (#135444)"](https://github.com/pytorch/pytorch/commit/4734e356d649d088a9e883c672a3ac08cd3d024d)
  - Broke tests on main ([comment](https://github.com/pytorch/pytorch/pull/134732#issuecomment-2348886378))
- [Revert "[Dynamo] Trace enter/exit of TorchFunctionModes (#135422)"](https://github.com/pytorch/pytorch/commit/ac169795a99554154d0dadb9583fc545d78c945b)
  - Broke tests on main ([comment](https://github.com/pytorch/pytorch/pull/134732#issuecomment-2348886378))
- [Revert "[Dynamo] Remove ignored modes workaround (#135502)"](https://github.com/pytorch/pytorch/commit/fca58bfda1be2cc78750ace68c146e12795e8f99)
  - Broke tests on main ([comment](https://github.com/pytorch/pytorch/pull/134732#issuecomment-2348886378))
- [Revert "[Dynamo] Remove ignored modes from torch function mode stack guard (#135503)"](https://github.com/pytorch/pytorch/commit/dc71e7a7d414d1ef91e0414a9842795f26917a61)
  - Broke tests on main ([comment](https://github.com/pytorch/pytorch/pull/134732#issuecomment-2348886378))
- [Revert "[ONNX] Update fake mode usage in onnx docs (#135512)"](https://github.com/pytorch/pytorch/commit/5b368de7f79b8c57ec6c37594cdfded826f37e86)
  - failing test  https://github.com/pytorch/pytorch/actions/runs/10778813316/job/29891679127 ([comment](https://github.com/pytorch/pytorch/pull/135512#issuecomment-2338999090))

### Landrace (12)

- [Revert "[Dynamo] Use custom backend to reenter metadata tf mode when tracing while/cond (#134732)"](https://github.com/pytorch/pytorch/commit/23dec79cefc4e4e859818a1d3df846525f3f7de9)
  - broke python test/quantization/pt2e/test_numeric_debugger.py TestNumericDebugger.test_re_export_preserve_handle modified yesterday ([comment](https://github.com/pytorch/pytorch/pull/134732#issuecomment-2350937008))
- [Revert "[Dynamo] Trace torch function modes entered outside of torch.compile (#133137)"](https://github.com/pytorch/pytorch/commit/8c8a3086a75e476a5b16c530e2ec0f33248566fb)
  - broke python test/quantization/pt2e/test_numeric_debugger.py TestNumericDebugger.test_re_export_preserve_handle modified yesterday ([comment](https://github.com/pytorch/pytorch/pull/134732#issuecomment-2350937008))
- [Revert "[Dynamo] Support thread local setattr (#135443)"](https://github.com/pytorch/pytorch/commit/46f50370076fe05a0051efdb8f6e8f6924e196a7)
  - broke python test/quantization/pt2e/test_numeric_debugger.py TestNumericDebugger.test_re_export_preserve_handle modified yesterday ([comment](https://github.com/pytorch/pytorch/pull/134732#issuecomment-2350937008))
- [Revert "[Dynamo] Simplify torch function mode stack guard (#135444)"](https://github.com/pytorch/pytorch/commit/7975ec3a2993be93623e69ee8ef195350bcbd7c6)
  - broke python test/quantization/pt2e/test_numeric_debugger.py TestNumericDebugger.test_re_export_preserve_handle modified yesterday ([comment](https://github.com/pytorch/pytorch/pull/134732#issuecomment-2350937008))
- [Revert "[Dynamo] Trace enter/exit of TorchFunctionModes (#135422)"](https://github.com/pytorch/pytorch/commit/f3180f008811065a489ed6dd3a56a2b725a7b0b1)
  - broke python test/quantization/pt2e/test_numeric_debugger.py TestNumericDebugger.test_re_export_preserve_handle modified yesterday ([comment](https://github.com/pytorch/pytorch/pull/134732#issuecomment-2350937008))
- [Revert "[Dynamo] Remove ignored modes workaround (#135502)"](https://github.com/pytorch/pytorch/commit/838c91250269c44b849f71bfd1db896df6a49dc2)
  - broke python test/quantization/pt2e/test_numeric_debugger.py TestNumericDebugger.test_re_export_preserve_handle modified yesterday ([comment](https://github.com/pytorch/pytorch/pull/134732#issuecomment-2350937008))
- [Revert "[Dynamo] Remove ignored modes from torch function mode stack guard (#135503)"](https://github.com/pytorch/pytorch/commit/72b868d034b7b9e59eebb85d50a61f67b2d101fa)
  - broke python test/quantization/pt2e/test_numeric_debugger.py TestNumericDebugger.test_re_export_preserve_handle modified yesterday ([comment](https://github.com/pytorch/pytorch/pull/134732#issuecomment-2350937008))
- [Revert "[Dynamo] Trace torch function modes entered outside of torch.compile (#133137)"](https://github.com/pytorch/pytorch/commit/183c32fd3b665414dc3700c2747da55406b14156)
  - something in this stack broke functorch/test_control_flow.py::TestControlFlow::test_scan_simple_graph [GH job link](https://github.com/pytorch/pytorch/actions/runs/10804912306/job/29980571390) [HUD commit link](https://hud.pytorch.org/pytorch/pytorch/commit/444b52ff40cf4afce7bc3fdcf021a88eab3b954c), newly added test yesterday ([comment](https://github.com/pytorch/pytorch/pull/133137#issuecomment-2344054339))
- [Revert "[Dynamo] Support thread local setattr (#135443)"](https://github.com/pytorch/pytorch/commit/3ab12e259691a0c8c4e58866751fe0d9c007acf6)
  - something in this stack broke functorch/test_control_flow.py::TestControlFlow::test_scan_simple_graph [GH job link](https://github.com/pytorch/pytorch/actions/runs/10804912306/job/29980571390) [HUD commit link](https://hud.pytorch.org/pytorch/pytorch/commit/444b52ff40cf4afce7bc3fdcf021a88eab3b954c), newly added test yesterday ([comment](https://github.com/pytorch/pytorch/pull/135443#issuecomment-2344042800))
- [Revert "[Dynamo] Simplify torch function mode stack guard (#135444)"](https://github.com/pytorch/pytorch/commit/f96e8041b145971280ec5a7fbecdeb3f11b17f89)
  - something in this stack broke functorch/test_control_flow.py::TestControlFlow::test_scan_simple_graph [GH job link](https://github.com/pytorch/pytorch/actions/runs/10804912306/job/29980571390) [HUD commit link](https://hud.pytorch.org/pytorch/pytorch/commit/444b52ff40cf4afce7bc3fdcf021a88eab3b954c), newly added test yesterday ([comment](https://github.com/pytorch/pytorch/pull/135444#issuecomment-2344036843))
- [Revert "[Dynamo] Use custom backend to reenter metadata tf mode when tracing while/cond (#134732)"](https://github.com/pytorch/pytorch/commit/7cf9c8191831148f50d0f21ff329c679155ed7f6)
  - broke functorch/test_control_flow.py::TestControlFlow::test_scan_simple_graph [GH job link](https://github.com/pytorch/pytorch/actions/runs/10804912306/job/29980571390) [HUD commit link](https://hud.pytorch.org/pytorch/pytorch/commit/444b52ff40cf4afce7bc3fdcf021a88eab3b954c), newly added test yesterday ([comment](https://github.com/pytorch/pytorch/pull/134732#issuecomment-2344016694))
- [Revert "NJT <-> padded dense conversions (#125947)"](https://github.com/pytorch/pytorch/commit/70a65a8bd5b5d092dbb73521e22e5fd31afa35c1)
  - Sorry for reverting your change but it is failing dynamo test https://hud.pytorch.org/pytorch/pytorch/commit/09a5e88bef04d5485b70d8f65f46a675aaa52942, maybe a landrace ([comment](https://github.com/pytorch/pytorch/pull/125947#issuecomment-2339228570))

### Not through pytorchbot (2)

- [Back out "[pytorch][PR] [export] fix re-export custom metadata" (#135634)](https://github.com/pytorch/pytorch/commit/4ae6d7c18f33b4f45fc2e248b2b0cb03f77a3127)
- [Revert "[fx] Bypass custom __setattr__ in Node.__init__ (#135079)" (#135562)](https://github.com/pytorch/pytorch/commit/440f8f57af890a8ec726c922dbe7df6e17a67668)

### No Signal (8)

- [Revert "[Pytorch] Consolidate Strobelight compile time profiler between OSS and fbcode (#135953)"](https://github.com/pytorch/pytorch/commit/357b7fb5793dad12b90ddb876254b9b30c0c6fd7)
  - Broke internal module factory compatibility, revert from Phabricator failed ([comment](https://github.com/pytorch/pytorch/pull/135953#issuecomment-2351381777))
- [Revert "Use _amp_foreach_non_finite_check_and_unscale_ for CPU grads of ShardedGradScaler (#135232)"](https://github.com/pytorch/pytorch/commit/1786a17fedefb85e86285732ec6e69c6d0cea2ea)
  - wrong commit ([comment](https://github.com/pytorch/pytorch/pull/135232#issuecomment-2350792806))
- [Revert "Pass ideep:lowp_kind to matmul_forward::compute on cache misses (#135058)"](https://github.com/pytorch/pytorch/commit/6ef49fe8f199d932d388b38f673b00d77503ec51)
  - It regresses x86 performance ([comment](https://github.com/pytorch/pytorch/pull/135058#issuecomment-2349480861))
- [Revert "[PT2][inductor][Optimus] Add pad_aten_mm_pass pattern to resolve long computation kernel in LCE (#135167)"](https://github.com/pytorch/pytorch/commit/1cdf658f4a6d865a94f9d89e7bb233a4a59f3d76)
  - Broke ROCm CI eg. https://github.com/pytorch/pytorch/actions/runs/10845542664/job/30097957154 ([comment](https://github.com/pytorch/pytorch/pull/135167#issuecomment-2348847595))
- [Revert "[dynamo] Fix support for classmethod(property(...)) (#134968)"](https://github.com/pytorch/pytorch/commit/b5c52e96e87ee45bead4f5381a778ad3b6dcccdc)
  - Broke ROCm CI: eg. https://github.com/pytorch/pytorch/actions/runs/10845542664/job/30097956613 ([comment](https://github.com/pytorch/pytorch/pull/134968#issuecomment-2348837553))
- [Revert "Check function declarations of Core ML code (#135467)"](https://github.com/pytorch/pytorch/commit/3de9e474dfa8d044f3c619d4f9244a3538426417)
  - This breaks ios periodic jobs, see https://github.com/pytorch/pytorch/actions/runs/10797026668/job/29947377532 ([comment](https://github.com/pytorch/pytorch/pull/135467#issuecomment-2347322784))
- [Revert "[DSD] Fix distributed state dict full_state_dict option hang during set_state_dict (#135725)"](https://github.com/pytorch/pytorch/commit/3e1a4ea13237461ba1c3acebeae7eac5506a87ec)
  - This is breaking lint. See [GH job link](https://github.com/pytorch/pytorch/actions/runs/10835983999/job/30068709508) [HUD commit link](https://hud.pytorch.org/pytorch/pytorch/commit/83c594ebd6dfa517fdd67ae23929cc60d5fa325d) ([comment](https://github.com/pytorch/pytorch/pull/135725#issuecomment-2347303272))
- [Revert "[Inductor] Make static_input_idxs a set for faster lookup (#135314)"](https://github.com/pytorch/pytorch/commit/73a6fc6e30d6b988557cecb7635f01381b617f08)
  - Lint is failing on this file in trunk. See [GH job link](https://github.com/pytorch/pytorch/actions/runs/10777258770/job/29885960050) [HUD commit link](https://hud.pytorch.org/pytorch/pytorch/commit/011cae9570fb3c44b7f6f0c8004c470579ed21da) ([comment](https://github.com/pytorch/pytorch/pull/135314#issuecomment-2338678219))

### Weird (3)

- [Revert "Validate input types for `torch.nn.Linear` and `torch.nn.Bilinear` (#135596)"](https://github.com/pytorch/pytorch/commit/b6d6aa49b839b11c6bb01688975d2ef77c3936d0)
  - It's too restrictive, should allow other int-like types, such as `numpy.int64` ([comment](https://github.com/pytorch/pytorch/pull/135596#issuecomment-2349714104))
- [Revert "[dynamo] Bug fix for _torchdynamo_inline source handling (#135612)"](https://github.com/pytorch/pytorch/commit/596e93b506d0ef94e4f502e8733e57fd862f1846)
  - broke inductor/test_cpu_select_algorithm.py::TestSelectAlgorithmCPU::test_linear_input_transpose_bias_True_cpu_float32 [GH job link](https://github.com/pytorch/pytorch/actions/runs/10805518363/job/29982386304) [HUD commit link](https://hud.pytorch.org/pytorch/pytorch/commit/5c3d0a2dedbc0e85f3b256ce56ac674078a5fae1), bad TD ([comment](https://github.com/pytorch/pytorch/pull/135612#issuecomment-2344039370))
- [Revert "Add  `__init__.py` to shape inference folder. (#135461)"](https://github.com/pytorch/pytorch/commit/689d278543bd9063f54c8797a00af4e9efdc5571)
  - Sorry for reverting your change but it exposes some public function without appropriate doc. I will reopen the issue with hi-prio so that it can be fixed properly ([comment](https://github.com/pytorch/pytorch/pull/135461#issuecomment-2339218382))
