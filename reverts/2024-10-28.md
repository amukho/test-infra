# Week of 2024-10-28 to 2024-11-04 (40)

### GHFirst (16)

- [Revert "Profile guided optimization for automatic_dynamic (#139001)"](https://github.com/pytorch/pytorch/commit/92d7f29e595ce055cd37abf7866b84fe5d387a32)
  - more fbcode errors ([comment](https://github.com/pytorch/pytorch/pull/139001#issuecomment-2452985581))
- [Revert "[Partitioner] Enumerate partitions by iterating partition ids (#136598)"](https://github.com/pytorch/pytorch/commit/2a3fe06ce0e7d5be65e6eef80e9b701c2c6f551a)
  - Sorry for reverting your change but it fails an executorch test https://github.com/pytorch/executorch/blob/main/exir/backend/test/test_graph_partition.py#L114-L175 ([comment](https://github.com/pytorch/pytorch/pull/136598#issuecomment-2452903705))
- [Revert "Allow inplacing buffer when other users are inconsequential (#138383)"](https://github.com/pytorch/pytorch/commit/f3238106fd0de13b6546021cadd32fe331951ff3)
  - Sorry for reverting this again, but I think it has a test failing internally and also on ROCm ([comment](https://github.com/pytorch/pytorch/pull/138383#issuecomment-2452898229))
- [Revert "[inductor] Remove SIMDKernel.last_usage (#139364)"](https://github.com/pytorch/pytorch/commit/0863d6a08eab75da72a660086e4fc7d2c14ca0e6)
  - Sorry for reverting your change but it is failing lots of internal tests in D65345157 ([comment](https://github.com/pytorch/pytorch/pull/139364#issuecomment-2452897337))
- [Revert "[inductor] Remove Node.last_usage mutation (#139365)"](https://github.com/pytorch/pytorch/commit/9331640e26cb9cc35750ec363129fd5a22037066)
  - Sorry for reverting your change but it is failing lots of internal tests in D65345157 ([comment](https://github.com/pytorch/pytorch/pull/139364#issuecomment-2452897337))
- [Revert "[inductor] Move remove_kernel_local_buffers to Kernel (#139370)"](https://github.com/pytorch/pytorch/commit/dc4b4597378caab201c32e9ee0821ebe14715f71)
  - Sorry for reverting your change but it is failing lots of internal tests in D65345157 ([comment](https://github.com/pytorch/pytorch/pull/139364#issuecomment-2452897337))
- [Revert "[inductor] Simplify remove_kernel_local_buffers (#139452)"](https://github.com/pytorch/pytorch/commit/66a401c9e1ee231fae8ec641f323cb12cfac8c1f)
  - Sorry for reverting your change but it is failing lots of internal tests in D65345157 ([comment](https://github.com/pytorch/pytorch/pull/139364#issuecomment-2452897337))
- [Revert "[inductor] sympy.Integer([01]) -> sympy.S.(Zero|One) (#139523)"](https://github.com/pytorch/pytorch/commit/98e11b002162004872a1e83ffc9ed12c10d42d33)
  - Sorry for reverting your change but it is failing lots of internal tests in D65345157 ([comment](https://github.com/pytorch/pytorch/pull/139364#issuecomment-2452897337))
- [Revert "Profile guided optimization for automatic_dynamic (#139001)"](https://github.com/pytorch/pytorch/commit/8d1eaa3da663c2bdd626ff1aafa1c5d0ff6e1bf3)
  - internal code triggers import cycle ([comment](https://github.com/pytorch/pytorch/pull/139001#issuecomment-2452833882))
- [Revert "[dynamo] Fix constant propagation in builtins and UserClasses (#131354)"](https://github.com/pytorch/pytorch/commit/b6b95966079e5fd02c620316f262ba172c77430b)
  - Sorry for reverting your change, but it seems to break some internal tests ([comment](https://github.com/pytorch/pytorch/pull/131354#issuecomment-2451050605))
- [Revert "Update tensorify pass to specialize symfloats we didn't tensorify away (#138868)"](https://github.com/pytorch/pytorch/commit/b9acbde4fd787bcb33212d72559150b0adee04b1)
  - Sorry for reverting your change but I think the new tests are failing on fbcode ([comment](https://github.com/pytorch/pytorch/pull/138868#issuecomment-2450863895))
- [Revert "[AOTI] Update zero size computation in clone_preserve_strides (#139224)"](https://github.com/pytorch/pytorch/commit/c4d9428b176179eda36e38a4e9009e8190c7dfbf)
  - Diff reverted internally ([comment](https://github.com/pytorch/pytorch/pull/139224#issuecomment-2450811914))
- [Revert "Use static_assert to detect get_type_index used in device code (#139173)"](https://github.com/pytorch/pytorch/commit/886579af99c85ea41b3650f74e00db26fd69d90b)
  - Diff reverted internally ([comment](https://github.com/pytorch/pytorch/pull/139173#issuecomment-2450695123))
- [Revert "Drop caffe2 string_utils (#139217)"](https://github.com/pytorch/pytorch/commit/ec5fbee6c045e73b0a096ce4df80d1b058ab4598)
  - Chatting with @r-barnes, this is still used in lots of place internally ([comment](https://github.com/pytorch/pytorch/pull/139217#issuecomment-2448568071))
- [Revert "Move reduce to template parameter in vectorized_reduction (#138672)"](https://github.com/pytorch/pytorch/commit/a951d99e1660a70f111be3cf000dd3dcd9ccfb7d)
  - Diff reverted internally ([comment](https://github.com/pytorch/pytorch/pull/138672#issuecomment-2446927015))
- [Revert "Fix unbind_copy and add its decomposition (#134319)"](https://github.com/pytorch/pytorch/commit/38645e8a3e65cc6befd232928bed51b538ad63ed)
  - Sorry for reverting your PR, but this is still failing the same test on ExecuTorch ([comment](https://github.com/pytorch/pytorch/pull/134319#issuecomment-2443209139))

### Ignored Signal (2)

- [Revert "Add conjugate method on SymFloat (#139249)"](https://github.com/pytorch/pytorch/commit/42d790bb6531e45b21701ff1b910e8aa311bb26a)
  - Sorry for reverting your change, but the doc build failure is legit ([comment](https://github.com/pytorch/pytorch/pull/139249#issuecomment-2448755839))
- [Revert " [3/N] Fix cppcoreguidelines-special-member-functions warnings (#138796)"](https://github.com/pytorch/pytorch/commit/9ca749d6cd08fb2502d36a0e2f4a306fec1e578c)
  - reverting since this started failing a windows test ([comment](https://github.com/pytorch/pytorch/pull/138796#issuecomment-2440710865))

### Landrace (4)

- [Revert "use more elements per thread for narrow dtypes (#139449)"](https://github.com/pytorch/pytorch/commit/c95adb9c5bd722931eaae04039672916b4466409)
  - Sorry for reverting your change, but a bunch of tests are failing after it lands, it looks like a landrace ([comment](https://github.com/pytorch/pytorch/pull/139449#issuecomment-2452723863))
- [Revert "[c10d][Partial-Graph Overlap] Support calling .wait_tensor() on output tensor of eager `async_op=True` collective if under `allow_inflight_collective_as_graph_input_ctx()` context manager (#137763)"](https://github.com/pytorch/pytorch/commit/e5595f10c843a893eabfc595080e9ce7eac4d16f)
  - Seems to have bad interaction with latest commits on trunk, reverting to be safe ([comment](https://github.com/pytorch/pytorch/pull/137763#issuecomment-2442527696))
- [Revert "Add test for consistency between meta and CPU devices. (#138515)"](https://github.com/pytorch/pytorch/commit/228963ad6004c83dd328817e6766700ea366e4a4)
  - Sorry for reverting your change, but the test is failing in trunk, maybe a landrace ([comment](https://github.com/pytorch/pytorch/pull/138515#issuecomment-2442357471))
- [Revert "Add sym_log2 (#137980)"](https://github.com/pytorch/pytorch/commit/2487a834a43db88b17891bfeec126fc812337842)
  - lint broke from this onwards on main ([comment](https://github.com/pytorch/pytorch/pull/137980#issuecomment-2441570186))

### Not through pytorchbot (2)

- [Revert D65167805 (#139371)](https://github.com/pytorch/pytorch/commit/f98bc9a49d7d6943963edc410e751a63af873501)
- [Back out "[compiled autograd] tls access helpers (#138061)" and Back out "[compiled autograd] Compiled autograd configs in TLS (#137821)" (#139086)](https://github.com/pytorch/pytorch/commit/fd9f4e67705bccbd10bdeb0085644937a304af88)

### No Signal (14)

- [Revert "[executorch hash update] update the pinned executorch hash (#139536)"](https://github.com/pytorch/pytorch/commit/3a2ab9584f6ce69bf9730c822fd08375c592bf38)
  - This is breaking trunk, need to fix before relanding ([comment](https://github.com/pytorch/pytorch/pull/139536#issuecomment-2453313984))
- [Revert "Expose Storage _use_count API in Python (#139426)"](https://github.com/pytorch/pytorch/commit/067d2a089d7289dd465184ee5abce7ad077c8f8e)
  - Sorry for reverting your change, but it is failing some inductor job in trunk ([comment](https://github.com/pytorch/pytorch/pull/139426#issuecomment-2453269063))
- [Revert "[PGNCCL] Make sure we do not use split for P2P comm creation (#139013)"](https://github.com/pytorch/pytorch/commit/854be65fa0f1fc0be86a395441a22eeb5bc2d633)
  - More flavor of test_manual_with_data_parallel failed ([comment](https://github.com/pytorch/pytorch/pull/139013#issuecomment-2453085932))
- [Revert "[AOTI] Switch OSS dashboard to use aoti_compile_and_package (#139154)"](https://github.com/pytorch/pytorch/commit/709752e0bbfee770b55e459aa012dd4bd3a67e20)
  - cpu_aot_inductor_amp_freezing fails ([comment](https://github.com/pytorch/pytorch/pull/139154#issuecomment-2452983651))
- [Revert "fix dynamo tracking numpy 2 ops (#138686)"](https://github.com/pytorch/pytorch/commit/b617d4813c4b125bb3c21677f92077d914c2127c)
  - Sorry for reverting your change, but I am seeing inductor failure with hf_BigBird number of graph breaks after it lands ([comment](https://github.com/pytorch/pytorch/pull/138686#issuecomment-2452718164))
- [Revert "[inductor] patterns to remove pointless view/permute pairs (#139136)"](https://github.com/pytorch/pytorch/commit/abb0dd4b00c7aad07a8f135ec348c7167810560e)
  - Sorry but this PR seems to have broken on trunk. The failure: distributed/_composable/test_replicate_with_compiler.py::ReplicateTest::test_bucketing_coalesced_op [GH job link](https://github.com/pytorch/pytorch/actions/runs/11615060962/job/32346609889) [HUD commit link](https://hud.pytorch.org/pytorch/pytorch/commit/2b86cd74a60ca2483173ba3012506aeac85ab2d7) ([comment](https://github.com/pytorch/pytorch/pull/139136#issuecomment-2450796414))
- [Revert "Allow inplacing buffer when other users are inconsequential (#138383)"](https://github.com/pytorch/pytorch/commit/289e03a4298839b57a58e5dd4eb1130da051ff45)
  - Sorry for reverting your change, but it seems to break trunk after landing ([comment](https://github.com/pytorch/pytorch/pull/138383#issuecomment-2448824206))
- [Revert "Add deterministic path for CUDA `cumsum` (#136224)"](https://github.com/pytorch/pytorch/commit/49bfbed2ebf0995b9a0c81a5c72f100248ad9098)
  - larger memory usage apparently not acceptable ([comment](https://github.com/pytorch/pytorch/pull/136224#issuecomment-2447382819))
- [Revert "Add support for index_put_ in NT (#135722)"](https://github.com/pytorch/pytorch/commit/5861279f4780a7dc7d5e7e6e8b97dcd9ba93947a)
  - Sorry for reverting your change, but it is failing on ROCm ([comment](https://github.com/pytorch/pytorch/pull/135722#issuecomment-2445651914))
- [Revert "Dont decompose aten.baddmm in inductor (#137904)"](https://github.com/pytorch/pytorch/commit/6aef58a249dd01b0ce521bca6b96211a32514679)
  - Sorry for reverting your change but I think the test is failing in trunk, maybe a landrace? ([comment](https://github.com/pytorch/pytorch/pull/137904#issuecomment-2443158194))
- [Revert "[PGNCCL] Make sure we do not use split for P2P comm creation (#139013)"](https://github.com/pytorch/pytorch/commit/02339e674d8891de9e5b772768324940cc4a4548)
  - Sorry but this appears to be breaking on trunk. See: distributed/_composable/test_composability/test_pp_composability.py::ComposabilityTest::test_manual_with_data_parallel_dp_type_DDP_ScheduleClass0_use_new_runtime_False [GH job link](https://github.com/pytorch/pytorch/actions/runs/11559910615/job/32177150816) [HUD commit link](https://hud.pytorch.org/pytorch/pytorch/commit/74878ac271feecfa3ff3d32f78c7d889bcac97d6) ([comment](https://github.com/pytorch/pytorch/pull/139013#issuecomment-2442667605))
- [Revert "[Inductor][ROCm][CK] Enable lowering conv2d instances in CK Inductor backend (#138643)"](https://github.com/pytorch/pytorch/commit/4dd04db5d0962fb8a1925cee831b9eb4f41ca4fd)
  - reverting due to a large number of internal failures, see below ([comment](https://github.com/pytorch/pytorch/pull/138643#issuecomment-2442036958))
- [Revert "Adds snapshot API for MemPools to get pool memory segments (#133601)"](https://github.com/pytorch/pytorch/commit/3b0f39336c88574fe63e8093d24fa00bcf6d2f62)
  - reverting for now as this breaks lots of internal tests. Details below ([comment](https://github.com/pytorch/pytorch/pull/133601#issuecomment-2441864871))
- [Revert "[inductor] Cooperative reductions (#137756)"](https://github.com/pytorch/pytorch/commit/60d1c7138da4aab619367cac192d71432ffeb32e)
  - ROCM tests are timing out :( ([comment](https://github.com/pytorch/pytorch/pull/137756#issuecomment-2441579322))

### Weird (2)

- [Revert "[dynamo, 3.13] fix bytecode nop tests (#139323)"](https://github.com/pytorch/pytorch/commit/3d3551506d4acccdd06d6f98eaf05e5288d254b3)
  - Sorry for reverting your change but it seems to cause a regression in instruction count metric ([comment](https://github.com/pytorch/pytorch/pull/139323#issuecomment-2451017609))
- [Revert "Don't uselessly recompute axiom dict every static eval call (#138967)"](https://github.com/pytorch/pytorch/commit/87f1990697c68bbe13f79147c9448f713e131462)
  - Sorry, looks like this PR introduced a failure that was incorrectly classified as flaky, and the log classifier didn't identify the right log line either ([comment](https://github.com/pytorch/pytorch/pull/138967#issuecomment-2450228525))
